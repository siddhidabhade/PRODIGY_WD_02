<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Innovative Stopwatch</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #d8c7ff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      transition: 0.3s;
    }

    body.dark {
      background: #2a2344;
      color: white;
    }

    .stopwatch {
      background: white;
      padding: 30px;
      border-radius: 12px;
      width: 340px;
      text-align: center;
      box-shadow: 0 6px 15px rgba(0,0,0,0.2);
      transition: 0.3s;
    }

    body.dark .stopwatch {
      background: #3a2f5c;
    }

    #display {
      font-size: 2.6rem;
      margin: 20px 0;
    }

    button {
      margin: 5px;
      padding: 10px 15px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #7b5cff;
      color: white;
      font-size: 14px;
      transition: transform 0.1s;
    }

    button:active {
      transform: scale(0.95);
    }

    ul {
      list-style: none;
      padding: 0;
      margin-top: 15px;
      max-height: 120px;
      overflow-y: auto;
    }

    li {
      background: #eee7ff;
      padding: 6px;
      margin: 5px 0;
      border-radius: 4px;
      font-size: 14px;
    }

    body.dark li {
      background: #4a3b73;
    }

    .info {
      font-size: 13px;
      margin-top: 10px;
      opacity: 0.8;
    }
  </style>
</head>
<body>

  <div class="stopwatch">
    <h2>Smart Stopwatch</h2>
    <div id="display">00:00:00</div>

    <div>
      <button onclick="toggle()">Start / Pause</button>
      <button onclick="reset()">Reset</button>
      <button onclick="lap()">Lap</button>
      <button onclick="toggleTheme()">Theme</button>
    </div>

    <ul id="laps"></ul>

    <div class="info" id="stats">Laps: 0 | Avg: 00:00:00</div>
    <div class="info">‚å® Space: Start | L: Lap | R: Reset</div>
  </div>

  <script>
    let startTime = 0;
    let elapsedTime = Number(localStorage.getItem("time")) || 0;
    let running = false;
    let timerInterval;
    let lapTimes = JSON.parse(localStorage.getItem("laps")) || [];

    const display = document.getElementById("display");
    const laps = document.getElementById("laps");
    const stats = document.getElementById("stats");

    function formatTime(time) {
      let ms = Math.floor((time % 1000) / 10);
      let s = Math.floor((time / 1000) % 60);
      let m = Math.floor((time / 60000) % 60);
      return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(ms).padStart(2,"0")}`;
    }

    function toggle() {
      running ? pause() : start();
    }

    function start() {
      running = true;
      startTime = Date.now() - elapsedTime;
      timerInterval = setInterval(() => {
        elapsedTime = Date.now() - startTime;
        display.textContent = formatTime(elapsedTime);
        localStorage.setItem("time", elapsedTime);
      }, 10);
    }

    function pause() {
      running = false;
      clearInterval(timerInterval);
    }

    function reset() {
      pause();
      elapsedTime = 0;
      lapTimes = [];
      display.textContent = "00:00:00";
      laps.innerHTML = "";
      updateStats();
      localStorage.clear();
    }

    function lap() {
      if (!running) return;
      lapTimes.push(elapsedTime);
      localStorage.setItem("laps", JSON.stringify(lapTimes));

      const li = document.createElement("li");
      li.textContent = `Lap ${lapTimes.length}: ${formatTime(elapsedTime)}`;
      laps.appendChild(li);
      updateStats();
    }

    function updateStats() {
      let avg = lapTimes.length
        ? lapTimes.reduce((a,b) => a+b, 0) / lapTimes.length
        : 0;
      stats.textContent = `Laps: ${lapTimes.length} | Avg: ${formatTime(avg)}`;
    }

    function toggleTheme() {
      document.body.classList.toggle("dark");
    }

    document.addEventListener("keydown", e => {
      if (e.code === "Space") toggle();
      if (e.key.toLowerCase() === "l") lap();
      if (e.key.toLowerCase() === "r") reset();
    });

    display.textContent = formatTime(elapsedTime);
    lapTimes.forEach(t => {
      const li = document.createElement("li");
      li.textContent = formatTime(t);
      laps.appendChild(li);
    });
    updateStats();
  </script>

</body>
</html>
